<%- include(templates+"header", {
  title: "Condition details | Permanent impairment", 
  heading: "Condition details"
}) %>

<%#- include(partials+"components/form-partials/yes_no", {
  label: "Are you and your doctor expecting any further improvement in your condition within the next two years?",
  yes_toggle: "#not-stable-container",
  no_toggle: ["#stable-container","#save-next"]
}); %>

<%- include(partials+"components/form-partials/yes_no", {
  label: "Does your medical practitioner expect that further treatment will improve your condition?",
  yes_toggle: "#not-stable-container",
  no_toggle: ["#stable-container","#save-next"]
}); %>

<%- include(partials+"components/form-partials/notice", {
  message: "Permanent impairment claims can only be considered where a condition has stabilised after appropriate treatment.",
  type: "warning",
  id: "not-stable",
  modifiers: ["hidden"]
}); %>

<%- include(partials+"components/form-partials/notice", {
  message: "<p>Where possible DVA will use your treating medical practitioners to provide an assessment. If we cannot use your treating practitioner we will arrange an assessment for you.</p><p>If you are a serving member be aware that on-base doctors will not be able to provide an assessment.</p><p></p> ",
  type: "alert",
  id: "stable",
  modifiers: ["hidden"]
}); %>

<div id="save-next" class="margin-above" hidden>
  <p>Choose <b>save and next</b> to continue.</p>
</div>

<%- include(forms+"pagination", {
  pagination: [
    {
      text: "Previous",
      link: "/auth/claim/permanent-impairment/permanent-impairment-02"
    },
    {
      text: "Exit application",
      link: "#open-modal"
    },
    {
      text: "Save and exit",
      link: "/auth",
      modifiers: ["floated"]
    },
    {
      text: "Save and next",
      link: "/auth/claim/permanent-impairment/permanent-impairment-04",
      modifiers: ["floated", "primary"]
    }
  ]
}) %>

<%- include(partials+"content/modals/application-cancel-modal") %>

<%- include(templates+"footer") %>

<script>

  $(document).ready(function () {

    $("input:radio").prop("checked", false);

    $('input[name=arrange-question]').change(function () {
      var mySelection = $('input[name=arrange-question]:checked').parent().find("span").text();
      if (mySelection == "Yes") {
        $("#save-next").show();
      } else {
        $("#save-next").show();
      }
    });

  });

  /* On page scrolling */

  function scrollToAdd() {
    $('html, body').animate({
      scrollTop: $("#add-options").offset().top
    }, 1000);
  }

  /* Clicks on "add" button */

  function showNewCard(cardType) {
    captureUserList();
    hideAll();
    var myDiv = "#" + cardType + "-card";
    var myForm = myDiv + " #myForm";
    var myDelete = myDiv + " #deleteButton";
    var myAdd = myDiv + " #addButton";
    $(myAdd).html("Add");
    $(myDelete).hide();
    $(myForm).trigger("reset");
    $(myDiv).show();
    console.log("-->" + myDiv);
    // $("#footer-buttons-mask").show();
    $('html, body').animate({
      scrollTop: $("#user-list").offset().top
    }, 1000);
  }

  /* Clicks on "add" on full card */

  function addSummary(cardType) {
    hideAll();
    var myDiv = "#" + cardType + "-summary";
    userEntries.push($(myDiv));
    displayUserList();
    $('html, body').animate({
      scrollTop: $("#user-list").offset().top
    }, 1000);
  };

  /* Clicks on "edit" on Summary Card */

  function editCard(cardType) {
    captureUserList();
    hideAll();
    var myDiv = "#" + cardType + "-card";
    var myDelete = myDiv + " #deleteButton";
    var myAdd = myDiv + " #addButton";
    $(myAdd).html("Update");
    $(myDelete).show();
    $(myDiv).show();
  }

  /* Clicks on "delete" on full card */

  function removeSummary(cardType) {
    hideAll();
    var myDiv = "#" + cardType + "-summary";
    userEntries.splice($.inArray(myDiv, userEntries), 1);
    displayUserList();
    $('html, body').animate({
      scrollTop: $("#user-list").offset().top
    }, 1000);
  };

  /* Clicks on "cancel" on full card */

  function cancelCard(cardType) {
    hideAll();
    $('html, body').animate({
      scrollTop: $("#user-list").offset().top
    }, 1000);
    displayUserList();
  }

  /* Update list after interaction */

  var userEntries = [];

  function captureUserList() {
    userEntries = $("[id*=summary]:visible");
  }

  function displayUserList() {
    $.each(userEntries, function (index, value) {
      $(value).show();
    });
    $("#add-medical-practitioner").show();
    $("#add-button").show();
  }

  /* Generic hide all */

  function hideAll() {
    $("#add-medical-practitioner").hide();
    $("#add-button").hide();
    $("#medical-practitioner-card").hide();
    $("#medical-practitioner-summary").hide();
  }
</script>
