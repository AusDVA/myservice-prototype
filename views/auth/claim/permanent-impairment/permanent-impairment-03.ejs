<%- include(templates+"header", {
  title: "Permanent impairment", 
  heading: "Medical details"
}) %>

<%- include(partials+"components/form-partials/yes_no", {
  label: "Are you currently undergoing treatment or have you recently had surgery for any of your accepted conditions?",
  yes_toggle: "#save-next",
  no_toggle: ["#no-doctors-container","#arrange-question-container"]
}); %>

<%- include(partials+"components/form-partials/notice", {
  message: "<p>You will need to have at least one assessment to help us to work out your level of impairment or lifestyle restriction. DVA can seek an assessment on your behalf should you wish; alternatively you may seek your own assessment via a medicalegal company.</p><p>If you are a serving member be aware that on-base doctors may not be willing to provide an assessment.</p> ",
  type: "alert",
  id: "no-doctors",
  modifiers: ["hidden"]
}); %>

<%- include(partials+"components/form-partials/yes_no", {
  label: "Would you like DVA to seek an assessment on your behalf?",
  hint: "DVA will contact you to arrange appointments and other details.",
  id: "arrange-question",
  modifiers: ["hintNewLine","hidden"]
}); %>

<div id="save-next" class="margin-above" hidden>
  <p>Choose <b>save and next</b> to continue.</p>
</div>

<%- include(forms+"pagination", {
  pagination: [
    {
      text: "Previous",
      link: "/auth/claim/permanent-impairment/permanent-impairment-02"
    },
    {
      text: "Exit application",
      link: "/auth/claim/permanent-impairment/permanent-impairment-02"
    },
    {
      text: "Save and exit",
      link: "/auth/claim/permanent-impairment/permanent-impairment-04",
      modifiers: ["floated"]
    },
    {
      text: "Save and next",
      link: "/auth/claim/permanent-impairment/permanent-impairment-04",
      modifiers: ["floated", "primary"]
    }
  ]
}) %>

<%- include(templates+"footer") %>

<script>

  $(document).ready(function () {

    $("input:radio").prop("checked", false);

    $('input[name=arrange-question]').change(function () {
      var mySelection = $('input[name=arrange-question]:checked').parent().find("span").text();
      if (mySelection == "Yes") {
        $("#save-next").show();
      } else {
        $("#save-next").show();
      }
    });

  });

  /* On page scrolling */

  function scrollToAdd() {
    $('html, body').animate({
      scrollTop: $("#add-options").offset().top
    }, 1000);
  }

  /* Clicks on "add" button */

  function showNewCard(cardType) {
    captureUserList();
    hideAll();
    var myDiv = "#" + cardType + "-card";
    var myForm = myDiv + " #myForm";
    var myDelete = myDiv + " #deleteButton";
    var myAdd = myDiv + " #addButton";
    $(myAdd).html("Add");
    $(myDelete).hide();
    $(myForm).trigger("reset");
    $(myDiv).show();
    console.log("-->" + myDiv);
    // $("#footer-buttons-mask").show();
    $('html, body').animate({
      scrollTop: $("#user-list").offset().top
    }, 1000);
  }

  /* Clicks on "add" on full card */

  function addSummary(cardType) {
    hideAll();
    var myDiv = "#" + cardType + "-summary";
    userEntries.push($(myDiv));
    displayUserList();
    $('html, body').animate({
      scrollTop: $("#user-list").offset().top
    }, 1000);
  };

  /* Clicks on "edit" on Summary Card */

  function editCard(cardType) {
    captureUserList();
    hideAll();
    var myDiv = "#" + cardType + "-card";
    var myDelete = myDiv + " #deleteButton";
    var myAdd = myDiv + " #addButton";
    $(myAdd).html("Update");
    $(myDelete).show();
    $(myDiv).show();
  }

  /* Clicks on "delete" on full card */

  function removeSummary(cardType) {
    hideAll();
    var myDiv = "#" + cardType + "-summary";
    userEntries.splice($.inArray(myDiv, userEntries), 1);
    displayUserList();
    $('html, body').animate({
      scrollTop: $("#user-list").offset().top
    }, 1000);
  };

  /* Clicks on "cancel" on full card */

  function cancelCard(cardType) {
    hideAll();
    $('html, body').animate({
      scrollTop: $("#user-list").offset().top
    }, 1000);
    displayUserList();
  }

  /* Update list after interaction */

  var userEntries = [];

  function captureUserList() {
    userEntries = $("[id*=summary]:visible");
  }

  function displayUserList() {
    $.each(userEntries, function (index, value) {
      $(value).show();
    });
    $("#add-medical-practitioner").show();
    $("#add-button").show();
  }

  /* Generic hide all */

  function hideAll() {
    $("#add-medical-practitioner").hide();
    $("#add-button").hide();
    $("#medical-practitioner-card").hide();
    $("#medical-practitioner-summary").hide();
  }
</script>
