<%- include(templates+"header", {
  claim: "Partner pension",
  heading: "Relationship status",
  progress: {
    activeItem: 2,
      points: [
      {
        text: "About your claim",
        link: "/auth/claim/cshc/a-01"
      },
      {
          text: "Relationship status",
          link: "/auth/claim/cshc/a-02"
        },
        {
          text: "Dependent children",
          link: "/auth/claim/cshc/a-03"
        },
        {
          text: "Residency",
          link: "/auth/claim/cshc/a-04"
        },
        {
          text: "Claim representative",
          link: "/auth/claim/cshc/a-05"
        },
        {
          text: "Payment details",
          link: "/auth/claim/cshc/a-06"
        },
      ]
    }
}) %>

<div id="no-prep-pop">
  <h3>Tell us about the veteran</h3>
  To be eligible for a Commonwealth Seniors Health Card we need to establish your relationship to a veteran with
  qualifying service.
  <hr>

  <%- include(forms+"prepop/ranktitlelist-dropdown", {
  label: "Title"
}) %>

  <%- include(forms+"text", {
  label: "Given name",
  hint: "(first name)"
}) %>

  <%- include(forms+"text", {
  label: "Surname",
  hint: "(last name)"
}) %>

  <%- include(forms+"yes_no", {
label: "Has your partner ever been known by any other names?",
hint: "For example: name at birth, maiden name, previous married name",
yes_toggle: "#previous-names-1-container",
modifiers: ["hintNewLine"]
}) %>

  <%- include(forms+"previous-names", {
modifiers: ["hidden"],
id: "previous-names-1"
}) %>


  <%- include(forms+"date", {
  label: "Date of birth"
}) %>

  <%- include(forms+"notice", {
message: `<p>You need to provide a copy of your partners birth certificate in the documents section.</p>`,
}) %>

  <%- include(forms+"prepop/gender") %>

  <%#- include(forms+"text", {
  label: "File number",
  hint: "(optional)"
}) %>

  <%#- include(forms+"text", {
  label: "Service number",
  hint: "(optional)"
}) %>


  <%#- include(forms+"text", {
  label: "PMKeyS number",
  hint: "(optional)"
}) %>

  <%- include(forms+"radio", {
  label: "What is your current relationship to the Veteran?",
  id: "known--veteran-relationship",
  boxes: [
    "Married",
    "De facto",
    {
      text: "Separated",
      hint: "(while still legally married)"
    },
    "Divorced",
    "Widowed"
  ]
}) %>

  <%- include(forms+"notice", {
  customClass: "divorce-blocker",
  modifiers: ["hidden"],
  type: "error",
  message: `<p>You may not be eligible for Commonwealth Seniors Health Card (CSHC).<br>
            If you would like to discuss your eligiblility, please contact DVA on <span class="dva-phone"></span></p>`
}) %>

  <%- include(forms+"date", {
  customClass: "de-facto--living-together",
  modifiers: ["hidden"],
  label: "Date commenced living together"
}) %>

  <%- include(forms+"date", {
  label: "Date of veterans' death",
  modifiers: ["hidden"],
  customClass: "date-of-death"
}) %>

  <%- include(forms+"date", {
    customClass: "married--married-date",
    modifiers: ["hidden"],
    label: "Date of marriage"
  }) %>

  <%- include(forms+"notice", {
  message: `<p>You will need to attach a copy of your marriage certificate in the documents section at the end of your claim.</p>`,
  customClass: "rel--married-non-vet",
  modifiers: ["hidden"]
}) %>



  <%- include(forms+"date", {
  customClass: "separation--date-separated",
  modifiers: ["hidden"],
  label: "Date of separation"
}) %>


  <%- include(partials+"components/form-partials/yes_no", {
label: "Are you currently in a new relationship and living together?",
id: "current",
yes_toggle: "#partner-questions",
no_toggle: "#save-next",
modifiers: ["hidden"]
}); %>

</div>

<%- include(forms+"pagination", {
  pagination: [
    {
      text: "Previous",
      link: "/auth"
    },
    {
      text: "Next",
      link: "/auth/claim/permanent-impairment/permanent-impairment-02",
      modifiers: ["floated", "primary"]
    }
  ]
}) %>

<%- include(partials+"content/modals/application-cancel-modal") %>

<%- include(templates+"footer") %>

<script>

  $("#known--veteran-relationship-container").on("change", "input", function () {
    $("#state--known .divorce-blocker").hide();
    unblock();
    $(".save-next").hide();
    $(".current-relationship").hide();
    $(".current-relationship").trigger("reset");

    if ($("#known--veteran-relationship-container :checked").val() === "widowed") {
      $(".known--widowed-hide").hide();
    } else {
      $(".known--widowed-hide").show();
    }

    $(".date-of-death").hide();
    $(".separation--date-separated").hide()
    $(".married--married-date").hide();
    $(".de-facto--living-together").hide();
    $(".divorce-blocker").hide();
    $("#partner-questions").hide();
    $("#current-container").hide();
    $("#current-partner-questions").hide();
    switch ($("#known--veteran-relationship-container :checked").val()) {
      case "divorced":
        $(".divorce-blocker").show();
        $(".rel--married-non-vet").hide();
        sessionStorage.setItem('CSHC-partnered', "false");
        block();
        break;
      case "married":
        $(".married--married-date").show();
        $(".rel--married-non-vet").show();
        $("#current-partner-questions").show();
        sessionStorage.setItem('CSHC-partnered', "true");
        break;
      case "defacto":
        $(".de-facto--living-together").show();
        $("#current-partner-questions").show();
        $(".rel--married-non-vet").hide();
        sessionStorage.setItem('CSHC-partnered', "true");
        break;
      case "separated":
        $(".separation--date-separated").show();
        $("#current-container").show();
        $(".rel--married-non-vet").hide();
        sessionStorage.setItem('CSHC-partnered', "false");
        // $("#partner-questions").show();
        break;
      case "widowed":
        $(".date-of-death").show();
        $(".rel--married-non-vet").hide();
        $("#current-container").show();
        sessionStorage.setItem('CSHC-partnered', "false");
        // $("#partner-questions").show();
        break;
    }
  })



  // page state related logic
  function updateContent() {
    hideAllStates();
    var myUser = sessionStorage.getItem('CSHC-flow');
    if (myUser == null) {
      $("#user-1").prop("checked", true);
      sessionStorage.setItem('CSHC-flow', "Veteran with QS");
      myUser = "Veteran with QS";
    }
    switch (myUser) {
      case "Veteran with QS":
        hideAllStates();
        $("#user-1").prop("checked", true);
        $("#veteran-qs").show();
        $("#no-qs-message").hide();
        break;
      case "Veteran without QS":
        hideAllStates();
        $("#user-2").prop("checked", true);
        $("#no-qs-message").show();
        $("#non-veteran").show();
        break;
      case "Non Veteran":
        hideAllStates();
        $("#user-3").prop("checked", true);
        $("#no-prep-pop").show();
        $("#non-veteran").show();
        break;
      case "War widow":
        hideAllStates();
        $("#user-4").prop("checked", true);
        $("#no-prep-pop").hide();
        $("#non-veteran").show();
        $("#pre-pop").show();
        $("#current-container").show();
        break;
    }
  };

  updateContent();

  function block() {
    $(".pagination a").attr("disabled", "true");
    $("#btnCancel").removeAttr("disabled");
  }

  function unblock() {
    $(".pagination a").removeAttr("disabled");
  }

  function hideAllStates() {
    $("#non-veteran").hide();
    $("#partner-questions").hide();
    $("#veteran-qs").hide();
    $("#veteran-no-qs").hide();
    $("#no-qs-message").hide();
    $("#pre-pop").hide();
  }

</script>